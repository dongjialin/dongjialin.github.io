<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>浏览器输入url并按下回车后，发生了什么 | 折纸屋</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">浏览器输入url并按下回车后，发生了什么</h1><a id="logo" href="/.">折纸屋</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">浏览器输入url并按下回车后，发生了什么</h1><div class="post-meta">2020-11-26</div><div class="post-content"><h4 id="解析url"><a href="#解析url" class="headerlink" title="解析url"></a>解析url</h4><p>浏览器通过地址栏捕获到url地址之后，首先对url地址进行解析。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">比如 “http:<span class="comment">//www.baidu.com/index.html?name=lin&amp;age=22#top”，</span></span><br><span class="line">在这个例子中我们可以分成六部分:</span><br><span class="line"><span class="number">1</span>、传输协议：http，https</span><br><span class="line"><span class="number">2</span>、域名： 例www.baidu.com为网站名字。 baidu.com为一级域名，www是服务器</span><br><span class="line"><span class="number">3</span>、端口： 不填写的话默认走的是<span class="number">80</span>端口号</span><br><span class="line"><span class="number">4</span>、路径 http:<span class="comment">//www.baidu.com/路径1/路径1.2。/表示根目录</span></span><br><span class="line"><span class="number">5</span>、携带的参数：？name=mo</span><br><span class="line"><span class="number">6</span>、锚点值：#top</span><br></pre></td></tr></table></figure>

<p>一个完整的url，包含上述几部分，协议部分一般都是 http或者https。域名部分可以是 一段域名例如：baidu.com 也可以是ip地址，域名最后也会被解析为ip地址。</p>
<p>该ip地址的作用就是在互联网中确定服务器的位置，紧接着是端口后，端口号确定的是在服务器中运行的具体的程序。路径部分表示的是在该程序中资源的具体标识，查询参数作用主要是为了发送数据。</p>
<h4 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h4><p>一般域名都需要购买，因为ip地址不方便记忆，域名比较好记。域名都会和ip地址绑定，那么，在这里就需要做DNS解析，所谓DNS解析其实就是，根据域名找到其绑定的 ip地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">浏览器缓存→系统缓存→路由器缓存→ISP DNS缓存→根域名服务器</span><br></pre></td></tr></table></figure>
<p>DNS的查找过程解析：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、浏览器会先检查是否存在缓存，因为如果访问过一次该域名的话，会把结果缓存在浏览器中。</span><br><span class="line"><span class="number">2</span>、操作系统也会有自己的DNS缓存，但在这之前，会检查域名是否存在于本地的Hosts文件中。</span><br><span class="line"><span class="number">3</span>、路由器中也会有自己的缓存。</span><br><span class="line"><span class="number">4</span>、IPS DNS缓存 就是在客户端电脑上设置的首选DNS服务器。</span><br><span class="line"><span class="number">5</span>、在前边所有的情况下都没有找到缓存的情况下，会连接互联网，把请求转发到互联网的根域。</span><br></pre></td></tr></table></figure>

<h4 id="TCP连接"><a href="#TCP连接" class="headerlink" title="TCP连接"></a>TCP连接</h4><p>确定好目标服务器的ip地址和端口号后，就开始和远程服务器建立TCP链接。过程如下：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">发送方：发送消息，等待...</span><br><span class="line">接收方：接收消息，并给发送方回信，此时发送方接收到消息后，从发送方的角度就可明白自己的消息是可以发过去的。但是接收方还不能确定自己的消息是否可以正常发送。</span><br><span class="line">发送方：接收到发送方的回信后，在给接收方发一个消息，此时从接收方的角度就能明白自己的消息可以可以正常发送。</span><br></pre></td></tr></table></figure>

<h4 id="发送http请求"><a href="#发送http请求" class="headerlink" title="发送http请求"></a>发送http请求</h4><p>http协议是建立在tcp/ip协议之上的，tcp保证连接通畅，http就可以正常的进行请求和响应了。首先http请求是一个无状态的请求，且只能由浏览器主动发起，服务器进行响应。</p>
<p>浏览器发送请求的报文会携带以下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请求路径</span><br><span class="line">查询参数</span><br><span class="line">请求方法</span><br><span class="line">请求头</span><br><span class="line">请求体</span><br></pre></td></tr></table></figure>

<h4 id="服务器接收请求"><a href="#服务器接收请求" class="headerlink" title="服务器接收请求"></a>服务器接收请求</h4><p>在服务端会监听浏览器端发送的http请求，当浏览器的请求发出后，服务端就会接受该请求，并解析出相应的信息，选择对应的逻辑进行处理（比如：查找对应的静态页面，保存文件，操作数据库，转发….）,并将处理的结果响应给浏览器端。</p>
<h4 id="服务器响应"><a href="#服务器响应" class="headerlink" title="服务器响应"></a>服务器响应</h4><p>服务器执行完逻辑之后，需要给浏览器响应内容（无论是要从服务器获取数据，还是在服务器做了什么操作，都需要给浏览器一个响应）</p>
<p>响应一般包含以下几部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">状态码</span><br><span class="line">状态文本</span><br><span class="line">响应头</span><br><span class="line">响应体</span><br></pre></td></tr></table></figure>
<p>服务器响应的同时肯定会伴随着浏览器端接收，等浏览器端彻底接收完毕之后，TCP就要进行4次挥手，并断开连接了。</p>
<h4 id="TCP链接断开"><a href="#TCP链接断开" class="headerlink" title="TCP链接断开"></a>TCP链接断开</h4><p>TCP链接的断开需要经过”四次挥手”，那么就需要一方主动的释放另外一方被动的释放。大体的过程如下：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、浏览器端发消息通知服务器现在需要断开（第一次挥手）</span><br><span class="line"><span class="number">2</span>、服务器接到要断开的请求之后，给浏览器返回消息，告诉浏览器我正在准备释放（第二次挥手）</span><br><span class="line"><span class="number">3</span>、此时浏览器接到消息后正在等待服务器释放完成，而服务器正在准备释放的过程</span><br><span class="line"><span class="number">4</span>、当服务器释放完成后，再通知浏览器我已经释放完成了。（第三次挥手）</span><br><span class="line"><span class="number">5</span>、浏览器接收到服务器释放完成的消息后，再给服务器发送消息告诉服务器我已经知道你释放完成了，服务器收到消息后，就能确认自己释放完成的消息已经通知到了（第四次挥手）</span><br></pre></td></tr></table></figure>

<h4 id="浏览器解析资源"><a href="#浏览器解析资源" class="headerlink" title="浏览器解析资源"></a>浏览器解析资源</h4><p>当浏览器接收到服务器响应的资源后，会对资源进行解析。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、首先，查看Response Header,根据响应头的指示做不同的事情，比如重定向，存储cookie，解压gzip，缓存资源等等。</span><br><span class="line"><span class="number">2</span>、接下来获取MIME类型（查看响应头的 Content-Type的值），根据不同的资源类型采用不同的解析方式</span><br></pre></td></tr></table></figure>
<h4 id="渲染页面"><a href="#渲染页面" class="headerlink" title="渲染页面"></a>渲染页面</h4><p>一般来说从地址栏输入地址后，绝大多是情况下响应的都是 html文件，那么就说以说页面是如何渲染html页面的，html页面中一般也会嵌入css，js，图片等资源。</p>
<p>因此如果解析到这些资源的时候，会再次向目标服务器发起请求，那么又会经历从解析url地址开始的各个步骤。</p>
<h4 id="html页面的加载"><a href="#html页面的加载" class="headerlink" title="html页面的加载"></a>html页面的加载</h4><p>首先要知道浏览器解析是从上往下一行一行地解析的。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、解码：传输回来的其实都是一些二进制字节数据，浏览器需要根据文件指定编码（例如UTF<span class="number">-8</span>）转换成字符串，也就是HTML 代码</span><br><span class="line"><span class="number">2</span>、预解析：预解析做的事情是提前加载资源，减少处理时间，它会识别一些会请求资源的属性，比如img标签的src属性，并将这个请求加到请求队列中。</span><br><span class="line"><span class="number">3</span>、符号化：符号化是词法分析的过程，将输入解析成符号，HTML 符号包括，开始标签、结束标签、属性名和属性值。它通过一个状态机去识别符号的状态，比如遇到&lt;，&gt;状态都会产生变化。</span><br><span class="line"><span class="number">4</span>、构建树：在上一步符号化中，解析器获得这些标记，然后以合适的方法创建DOM对象并把这些符号插入到DOM对象中。</span><br></pre></td></tr></table></figure>
<h4 id="CSS解析"><a href="#CSS解析" class="headerlink" title="CSS解析"></a>CSS解析</h4><p>一旦浏览器下载了 CSS，CSS 解析器就会处理它遇到的任何 CSS，根据语法规范解析出所有的 CSS 并进行标记化，然后我们得到一个规则表。</p>
<p>在匹配一个节点对应的 CSS 规则时，是按照从右到左的顺序的，例如：div p { font-size :14px }会先寻找所有的p标签然后判断它的父元素是否为div。</p>
<h4 id="javaScript编译执行"><a href="#javaScript编译执行" class="headerlink" title="javaScript编译执行"></a>javaScript编译执行</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、词法分析：<span class="keyword">js</span>脚本加载完毕后，会首先进入语法分析阶段，它首先会分析代码块的语法是否正确，不正确则抛出“语法错误”，停止执行。</span><br><span class="line"><span class="number">2</span>、预编译：<span class="keyword">js</span>有三种运行环境分别是 全局环境，函数环境，eval。每进入一个不同的运行环境都会创建一个对应的执行上下文，根据不同的上下文环境，形成一个函数调用栈，栈底永远是全局执行上下文，栈顶则永远是当前执行上下文。</span><br><span class="line"><span class="number">3</span>、执行：<span class="keyword">js</span>虽然是单线程的，但是实际参与工作的线程一共有四个：<span class="keyword">JS</span>引擎线程（主），事件触发线程，定时器触发线程，HTTP异步请求线程</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>浏览地地址栏输入地址按下回车，必然会经历以下几个步骤：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、解析url地址</span><br><span class="line"><span class="number">2</span>、DNS解析</span><br><span class="line"><span class="number">3</span>、TCP链接</span><br><span class="line"><span class="number">4</span>、发送http请求</span><br><span class="line"><span class="number">5</span>、服务器接收请求</span><br><span class="line"><span class="number">6</span>、服务器响应</span><br><span class="line"><span class="number">7</span>、TCP链接断开</span><br><span class="line"><span class="number">8</span>、浏览器解析资源</span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/%E6%8A%80%E6%9C%AF/"><i class="fa fa-tag"></i>技术</a></div><div class="post-nav"><a class="pre" href="/2021/03/11/github/">github访问小技巧</a><a class="next" href="/2020/11/10/leetcode/">leetcode刷题</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.dongjialin.top"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/" style="font-size: 15px;">碎碎念</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">技术</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/11/19/hexo-start/">hexo_start</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/11/19/gotime/">golang时间戳转换</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/10/phpcalculation/">PHP高精度计算函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/17/in-array/">in_array优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/11/github/">github访问小技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/26/http/">浏览器输入url并按下回车后，发生了什么</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/10/leetcode/">leetcode刷题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/07/go1/">golang小笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/06/hello-world/">你好，朋友</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.dongjialin.top/" title="RGB颜色值" target="_blank">RGB颜色值</a><ul></ul><a href="https://web.okjike.com/" title="即刻" target="_blank">即刻</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">折纸屋.</a><div></div><div class="github-badge"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hexo</span></div> <div class="github-badge"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></div></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>